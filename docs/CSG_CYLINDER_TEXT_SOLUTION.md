# CSG åœ†æŸ±é¢æ–‡å­—ç”Ÿæˆæ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬æ–¹æ¡ˆä½¿ç”¨ CSGï¼ˆæ„é€ å®ä½“å‡ ä½•ï¼‰å¸ƒå°”æ“ä½œæ¥ç”Ÿæˆå®Œç¾è´´åˆåœ†æŸ±é¢çš„ 3D æ–‡å­—ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„åæ ‡æ˜ å°„æ–¹æ³•ï¼ŒCSG æ–¹æ¡ˆèƒ½å¤Ÿç”Ÿæˆè¾¹ç¼˜å®Œç¾è´´åˆæ›²é¢çš„æ–‡å­—å‡ ä½•ä½“ã€‚

## æ ¸å¿ƒæ€è·¯

### é—®é¢˜èƒŒæ™¯

åœ¨åœ†æŸ±é¢ä¸Šç”Ÿæˆæ–‡å­—æ—¶ï¼Œä¼ ç»Ÿæ–¹æ³•æ˜¯å¯¹å¹³é¢æ–‡å­—å‡ ä½•ä½“çš„é¡¶ç‚¹è¿›è¡Œåæ ‡æ˜ å°„å˜æ¢ï¼Œå°†å…¶"å¼¯æ›²"åˆ°åœ†æŸ±é¢ä¸Šã€‚è¿™ç§æ–¹æ³•å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. æ–‡å­—è¾¹ç¼˜å¯èƒ½ä¸å®Œç¾è´´åˆæ›²é¢
2. éœ€è¦æ‰‹åŠ¨è®¡ç®—å¤æ‚çš„å¼¯æ›²å˜å½¢
3. å¯¹äºå¤æ‚å­—å½¢å¯èƒ½äº§ç”Ÿå˜å½¢

### CSG æ–¹æ¡ˆ

**æ ¸å¿ƒæ€æƒ³**ï¼šè®©åœ†æŸ±é¢è‡ªå·±"å‘Šè¯‰"æ–‡å­—åº”è¯¥æ˜¯ä»€ä¹ˆå½¢çŠ¶ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å»è®¡ç®—ã€‚

#### æ–¹æ¡ˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ç”Ÿæˆåšæ–‡å­— (TextGeometry, height=30)               â”‚
â”‚          ä½œä¸º"åˆ‡å‰²å·¥å…·"ï¼Œä»åœ†æŸ±å¤–éƒ¨ç©¿é€åˆ°å†…éƒ¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: åˆ›å»ºåœ†æŸ±å£³                                         â”‚
â”‚          å¤–å±‚åœ†æŸ±(radius) - å†…å±‚åœ†æŸ±(radius - thickness)    â”‚
â”‚          å¾—åˆ°åšåº¦ä¸º thickness çš„åœ†æŸ±å£³                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: æ–‡å­— âˆ© åœ†æŸ±å£³                                      â”‚
â”‚          å¸ƒå°”äº¤é›†æ“ä½œï¼Œå¾—åˆ°è´´åˆåœ†æŸ±é¢çš„æ–‡å­—                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯å®ç°

### 1. åšæ–‡å­—å‡ ä½•ä½“ç”Ÿæˆ

```javascript
// ç”Ÿæˆè¾ƒåšçš„ TextGeometryï¼ˆç”¨äºç©¿é€åœ†æŸ±ï¼‰
const geometry = new TextGeometry(text, {
  font: font,
  size: config.size,
  height: 30,  // å¾ˆåšï¼Œç¡®ä¿èƒ½ç©¿é€åœ†æŸ±
  curveSegments: 12
})

// å±…ä¸­æ–‡å­—ï¼ˆXã€Yã€Z æ–¹å‘éƒ½å±…ä¸­ï¼‰
// Z æ–¹å‘ä» -15 åˆ° +15ï¼Œç¡®ä¿èƒ½åŒæ—¶å‘å†…å’Œå‘å¤–å»¶ä¼¸
geometry.translate(centerX, centerY, centerZ)
```

**å…³é”®ç‚¹**ï¼š
- æ–‡å­—åšåº¦è®¾ä¸º 30ï¼ˆè¿œå¤§äºåœ†æŸ±å£³åšåº¦ï¼‰
- Z æ–¹å‘å±…ä¸­ï¼Œä½¿æ–‡å­—èƒ½ä»åœ†æŸ±å¤–éƒ¨ç©¿é€åˆ°å†…éƒ¨

### 2. æ–‡å­—å˜æ¢çŸ©é˜µè®¡ç®—

```javascript
// è®¡ç®—æ–‡å­—åœ¨åœ†æŸ±é¢ä¸Šçš„ä½ç½®å’Œæœå‘
const textCenter = cylinderCenter
  .add(axis.multiplyScalar(heightOnAxis))  // æ²¿è½´å‘å®šä½
  .add(radialDir.multiplyScalar(radius))   // æ”¾åœ¨åœ†æŸ±è¡¨é¢

// æ„å»ºæ—‹è½¬çŸ©é˜µ
// X æ–¹å‘ â†’ åˆ‡çº¿æ–¹å‘ï¼ˆæ²¿åœ†å‘¨ï¼‰
// Y æ–¹å‘ â†’ è½´å‘ï¼ˆæ²¿åœ†æŸ±è½´ï¼‰
// Z æ–¹å‘ â†’ å¾„å‘ï¼ˆæŒ‡å‘å¤–éƒ¨ï¼‰
const rotationMatrix = new Matrix4()
rotationMatrix.makeBasis(tangentDir, axisNorm, radialDir)
```

**åæ ‡ç³»æ˜ å°„**ï¼š
| æ–‡å­—å±€éƒ¨åæ ‡ | åœ†æŸ±é¢æ–¹å‘ |
|-------------|-----------|
| X (å®½åº¦)    | åˆ‡çº¿æ–¹å‘ï¼ˆæ²¿åœ†å‘¨ï¼‰ |
| Y (é«˜åº¦)    | è½´å‘ï¼ˆæ²¿åœ†æŸ±è½´ï¼‰ |
| Z (åšåº¦)    | å¾„å‘ï¼ˆæŒ‡å‘å¤–éƒ¨ï¼‰ |

### 3. åœ†æŸ±å£³åˆ›å»º

```javascript
// å¤–å±‚åœ†æŸ±
const outerGeometry = new CylinderGeometry(radius, radius, height, 64)

// å†…å±‚åœ†æŸ±
const innerRadius = radius - thickness
const innerGeometry = new CylinderGeometry(innerRadius, innerRadius, height, 64)

// åœ†æŸ±å£³ = å¤–å±‚ - å†…å±‚
const shellGeometry = evaluator.evaluate(outerBrush, innerBrush, SUBTRACTION)
```

### 4. å¸ƒå°”äº¤é›†æ“ä½œ

```javascript
// æ–‡å­—ä¸åœ†æŸ±å£³æ±‚äº¤
const resultGeometry = evaluator.evaluate(textBrush, shellBrush, INTERSECTION)
```

## å‡ ä½•å…³ç³»ç¤ºæ„å›¾

### ä¿¯è§†å›¾ï¼ˆä»ä¸Šå¾€ä¸‹çœ‹ï¼‰

```
                    åœ†æŸ±å£³æˆªé¢
                   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
                 â•±             â•²
               â•±                 â•²
              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
              â”‚    â”‚  å†…å±‚   â”‚    â”‚  â† å†…å±‚åœ†æŸ± (radius - thickness)
              â”‚    â”‚  ç©ºå¿ƒ   â”‚    â”‚
              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
               â•²                 â•±
                 â•²             â•±
                   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯     â† å¤–å±‚åœ†æŸ± (radius)
                   
        æ–‡å­—ä»è¿™é‡Œç©¿è¿‡ â”€â”€â†’ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â† åšæ–‡å­—å‡ ä½•ä½“
                         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

### ä¾§è§†å›¾

```
        åœ†æŸ±å£³                    æ–‡å­—
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚              â”‚         â”‚
     â”‚  â”Œâ”€â”€â”€â”  â”‚              â”‚  TEXT   â”‚
     â”‚  â”‚   â”‚  â”‚    âˆ©         â”‚         â”‚
     â”‚  â”‚   â”‚  â”‚   â”€â”€â”€â†’       â”‚         â”‚
     â”‚  â”‚   â”‚  â”‚              â”‚         â”‚
     â”‚  â””â”€â”€â”€â”˜  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              
                                   â†“
                              
                         è´´åˆåœ†æŸ±é¢çš„æ–‡å­—
                            â•­â”€â”€â”€â”€â”€â•®
                           â•± TEXT  â•²
                          â•±         â•²
```

## é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `textHeight` | 30 | æ–‡å­—å‡ ä½•ä½“åšåº¦ï¼ˆç”¨äºåˆ‡å‰²ï¼‰ |
| `thickness` | 0.5 | æœ€ç»ˆæ–‡å­—å‡¸å‡ºé«˜åº¦ |
| `size` | 1 | æ–‡å­—å¤§å° |
| `cylinderSegments` | 64 | åœ†æŸ±ä½“åˆ†æ®µæ•°ï¼ˆè¶Šé«˜è¶Šç²¾ç¡®ï¼‰ |
| `curveSegments` | 12 | æ–‡å­—æ›²çº¿åˆ†æ®µæ•° |

## ä½¿ç”¨æ–¹å¼

```javascript
import { CSGCylinderText } from './CSGCylinderText.js'

const generator = new CSGCylinderText()

// åœ†æŸ±ä¿¡æ¯
const cylinderInfo = {
  center: new THREE.Vector3(0, 2.5, 0),
  axis: new THREE.Vector3(0, 1, 0),
  radius: 2,
  height: 5  // å¯é€‰
}

// æ–‡å­—é™„ç€ç‚¹ï¼ˆåœ†æŸ±è¡¨é¢ä¸Šçš„ä¸€ç‚¹ï¼‰
const attachPoint = new THREE.Vector3(2, 2.5, 0)

// ç”Ÿæˆæ–‡å­—å‡ ä½•ä½“
const textGeometry = generator.generateSimple(
  'HELLO',
  font,
  cylinderInfo,
  attachPoint,
  {
    size: 0.5,
    thickness: 0.2
  }
)

// åˆ›å»ºç½‘æ ¼
const mesh = new THREE.Mesh(textGeometry, material)
scene.add(mesh)
```

## ä¼˜ç¼ºç‚¹åˆ†æ

### ä¼˜ç‚¹

1. **ç²¾ç¡®è´´åˆ**ï¼šæ–‡å­—è¾¹ç¼˜å®Œç¾è´´åˆåœ†æŸ±æ›²é¢
2. **æ— å˜å½¢**ï¼šä¸éœ€è¦æ‰‹åŠ¨è®¡ç®—å¼¯æ›²å˜å½¢
3. **æ‹“æ‰‘æ­£ç¡®**ï¼šç”Ÿæˆçš„å‡ ä½•ä½“æ˜¯é—­åˆæµå½¢ï¼Œé€‚åˆåç»­å¸ƒå°”æ“ä½œ
4. **é€šç”¨æ€§å¼º**ï¼šé€‚ç”¨äºä»»æ„è½´å‘çš„åœ†æŸ±

### ç¼ºç‚¹

1. **æ€§èƒ½å¼€é”€**ï¼šå¸ƒå°”æ“ä½œæ¯”åæ ‡æ˜ å°„æ…¢
2. **ä¾èµ–åº“**ï¼šéœ€è¦ `three-bvh-csg` åº“
3. **å¤æ‚åº¦**ï¼šå®ç°æ¯”åæ ‡æ˜ å°„å¤æ‚

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘åœ†æŸ±åˆ†æ®µæ•°**ï¼š`cylinderSegments` ä» 64 é™åˆ° 32
2. **ç®€åŒ–æ–‡å­—**ï¼šå‡å°‘ `curveSegments`
3. **ç¼“å­˜ç»“æœ**ï¼šå¯¹ç›¸åŒæ–‡å­—å’Œé…ç½®ç¼“å­˜ç”Ÿæˆçš„å‡ ä½•ä½“
4. **å¼‚æ­¥ç”Ÿæˆ**ï¼šåœ¨ Web Worker ä¸­æ‰§è¡Œå¸ƒå°”æ“ä½œ

## æ–‡ä»¶ç»“æ„

```
src/utils/surfaceText/
â”œâ”€â”€ CSGCylinderText.js      # CSG åœ†æŸ±é¢æ–‡å­—ç”Ÿæˆå™¨
â”œâ”€â”€ TextGeometryGenerator.js # æ–‡å­—å‡ ä½•ä½“ç”Ÿæˆå™¨ï¼ˆå·²é›†æˆ CSG æ–¹æ³•ï¼‰
â”œâ”€â”€ SurfaceTextManager.js    # è¡¨é¢æ–‡å­—ç®¡ç†å™¨
â””â”€â”€ test-csg-cylinder-text.js # æµ‹è¯•æ–‡ä»¶
```

## åˆ‡æ¢ç”Ÿæˆæ–¹æ³•

```javascript
// ä½¿ç”¨ CSG æ–¹æ³•ï¼ˆé»˜è®¤ï¼Œæ›´ç²¾ç¡®ï¼‰
surfaceTextManager.setCylinderTextMethod('csg')

// ä½¿ç”¨åæ ‡æ˜ å°„æ–¹æ³•ï¼ˆæ›´å¿«ï¼‰
surfaceTextManager.setCylinderTextMethod('mapping')
```

## è°ƒè¯•ä¿¡æ¯

ç”Ÿæˆè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºä»¥ä¸‹è°ƒè¯•ä¿¡æ¯ï¼š

```
ğŸ”§ CSGCylinderText.generateSimple å¼€å§‹
ğŸ“ åšæ–‡å­—å‡ ä½•ä½“åˆ›å»ºå®Œæˆ: { width, height, depth, zRange, vertices }
ğŸ”„ æ–‡å­—å˜æ¢çŸ©é˜µè®¡ç®—å®Œæˆ: { textCenter, tangentDir, radialDir, axisNorm }
ğŸ”µ åœ†æŸ±å£³åˆ›å»ºå®Œæˆ: { outerRadius, innerRadius, thickness, height, vertices }
ğŸ“¦ æ–‡å­—è¾¹ç•Œæ¡†ï¼ˆå˜æ¢åï¼‰: { min, max }
ğŸ“¦ åœ†æŸ±å£³è¾¹ç•Œæ¡†: { min, max }
ğŸ“¦ è¾¹ç•Œæ¡†æ˜¯å¦ç›¸äº¤: true/false
âš™ï¸ æ‰§è¡Œå¸ƒå°”äº¤é›†: æ–‡å­— âˆ© åœ†æŸ±å£³
âœ… å¸ƒå°”äº¤é›†å®Œæˆ: { vertices, resultBbox }
âœ… CSG åœ†æŸ±é¢æ–‡å­—ç”Ÿæˆå®Œæˆï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼Œè€—æ—¶: XXms
```

## å¸¸è§é—®é¢˜

### Q: ç”Ÿæˆçš„æ–‡å­—å¾ˆå°æˆ–çœ‹ä¸è§ï¼Ÿ

æ£€æŸ¥ï¼š
1. æ–‡å­—è¾¹ç•Œæ¡†å’Œåœ†æŸ±å£³è¾¹ç•Œæ¡†æ˜¯å¦ç›¸äº¤
2. åœ†æŸ±ä¿¡æ¯ï¼ˆcenter, axis, radiusï¼‰æ˜¯å¦æ­£ç¡®
3. é™„ç€ç‚¹æ˜¯å¦åœ¨åœ†æŸ±è¡¨é¢ä¸Š

### Q: å¸ƒå°”æ“ä½œå¤±è´¥ï¼Ÿ

å¯èƒ½åŸå› ï¼š
1. å‡ ä½•ä½“ä¸æ˜¯é—­åˆæµå½¢
2. å‡ ä½•ä½“æ²¡æœ‰ç´¢å¼•
3. å‡ ä½•ä½“å¤ªå¤æ‚

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
- å°è¯•ç®€åŒ–æ–‡å­—ï¼ˆå‡å°‘å­—ç¬¦æ•°ï¼‰
- é™ä½åˆ†æ®µæ•°

### Q: æ€§èƒ½å¤ªæ…¢ï¼Ÿ

ä¼˜åŒ–å»ºè®®ï¼š
1. å‡å°‘ `cylinderSegments`ï¼ˆ32 é€šå¸¸è¶³å¤Ÿï¼‰
2. å‡å°‘ `curveSegments`
3. ä½¿ç”¨æ›´çŸ­çš„æ–‡å­—
4. è€ƒè™‘ä½¿ç”¨åæ ‡æ˜ å°„æ–¹æ³•ä½œä¸ºå¤‡é€‰
