# ç¨³å®šåå­—æ„å»ºåŸç†æŠ€æœ¯æ–‡æ¡£

## ğŸ¯ **æ ¸å¿ƒé—®é¢˜**

åœ¨3Dæ¨¡å‹çš„é¢æ‹¾å–ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå‡ ä½•ç‰¹å¾ï¼ˆå¹³é¢ã€åœ†æŸ±é¢ç­‰ï¼‰ç”Ÿæˆä¸€ä¸ª**ç¨³å®šå”¯ä¸€**çš„åå­—ï¼Œæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

1. **ç¨³å®šæ€§**ï¼šç›¸åŒçš„å‡ ä½•ç‰¹å¾æ¯æ¬¡éƒ½ç”Ÿæˆç›¸åŒçš„åå­—
2. **å”¯ä¸€æ€§**ï¼šä¸åŒçš„å‡ ä½•ç‰¹å¾ç”Ÿæˆä¸åŒçš„åå­—  
3. **å¯æŒä¹…åŒ–**ï¼šåå­—å¯ä»¥ä¿å­˜åˆ°JSONä¸­ï¼Œä¸‹æ¬¡åŠ è½½æ—¶èƒ½æ­£ç¡®æ‰¾å›å¯¹åº”çš„ç‰¹å¾
4. **å‡ ä½•æ— å…³æ€§**ï¼šä¸ä¾èµ–ä¸‰è§’å½¢ç´¢å¼•ç­‰æ˜“å˜çš„ä¿¡æ¯
5. **æ•°å€¼ç¨³å®šæ€§**ï¼šä¸å—æµ®ç‚¹æ•°ç²¾åº¦è¯¯å·®å½±å“

## âš ï¸ **ä¼ ç»Ÿæ–¹æ¡ˆçš„è‡´å‘½ç¼ºé™·**

### é—®é¢˜åˆ†æ
ä¼ ç»ŸåŸºäºæµ®ç‚¹æ•°è®¡ç®—çš„æ–¹æ¡ˆå­˜åœ¨ä¸¥é‡é—®é¢˜ï¼š

```javascript
// âŒ ä¸é è°±çš„æ–¹æ¡ˆ
generateCylinderGeometryHash(axis, radius, segments) {
  const axisStr = `${Math.round(axis.x * 1000)},${Math.round(axis.y * 1000)},${Math.round(axis.z * 1000)}`
  const radiusStr = Math.round(radius * 1000).toString()
  // é—®é¢˜ï¼šaxiså’Œradiusæ¯æ¬¡è®¡ç®—å¯èƒ½ä¸åŒï¼
}
```

**è‡´å‘½ç¼ºé™·**ï¼š
1. **æµ®ç‚¹æ•°ä¸ç¨³å®š**ï¼š`axis.x`ã€`radius`ç­‰å€¼æ¯æ¬¡è®¡ç®—å¯èƒ½æœ‰å¾®å°å·®å¼‚
2. **ç´¯ç§¯è¯¯å·®**ï¼šå¤šæ¬¡å‡ ä½•è¿ç®—ä¼šæ”¾å¤§è¯¯å·®
3. **å¹³å°å·®å¼‚**ï¼šä¸åŒè®¾å¤‡çš„æµ®ç‚¹è¿ç®—å¯èƒ½æœ‰å·®å¼‚
4. **ç®—æ³•ä¾èµ–**ï¼šä¾èµ–ä¸ç¨³å®šçš„å‡ ä½•è®¡ç®—ç»“æœ

## ğŸ’¡ **æ–°æ–¹æ¡ˆï¼šåŸºäºåŸå§‹æ¨¡å‹é¡¶ç‚¹ç´¢å¼•çš„ç¨³å®šæ ‡è¯†**

### æ ¸å¿ƒæ€è·¯
**åŸºäºåŸå§‹æ¨¡å‹çš„å›ºå®šé¡¶ç‚¹ç´¢å¼•ï¼Œé€šè¿‡ç›¸é‚»å‹ç¼©ç”Ÿæˆç¨³å®šå”¯ä¸€çš„æ ‡è¯†**

```
ä¼ ç»Ÿæ–¹æ¡ˆï¼šå‡ ä½•è®¡ç®— â†’ æµ®ç‚¹æ•° â†’ å“ˆå¸Œ â†’ åå­— (ä¸ç¨³å®šâŒ)
æ–°æ–¹æ¡ˆï¼š  é¡¶ç‚¹ç´¢å¼• â†’ æ’åºå»é‡ â†’ ç›¸é‚»å‹ç¼© â†’ åå­— (ç»å¯¹ç¨³å®šâœ…)
```

### æ–¹æ¡ˆåŸç†

#### 1. åŸºäºåŸå§‹æ¨¡å‹çš„å›ºå®šé¡¶ç‚¹ç´¢å¼•
```javascript
// âœ… åŸå§‹æ¨¡å‹çš„é¡¶ç‚¹ç´¢å¼•æ˜¯å›ºå®šçš„
åŸå§‹æ¨¡å‹åŠ è½½: vertices = [v0, v1, v2, v3, ..., v1000]
åœ†æŸ±é¢åŒ…å«çš„é¡¶ç‚¹: [100, 101, 102, 103, 104, 105, ..., 132]
// æ¯æ¬¡åŠ è½½ç›¸åŒæ¨¡å‹ï¼Œé¡¶ç‚¹ç´¢å¼•å®Œå…¨ä¸€è‡´
```

#### 2. æå–ç‰¹å¾çš„æ‰€æœ‰é¡¶ç‚¹ç´¢å¼•
```javascript
// ä»ç‰¹å¾çš„ä¸‰è§’å½¢ä¸­æå–æ‰€æœ‰é¡¶ç‚¹ç´¢å¼•
function extractVertexIndices(triangleIndices, geometry) {
  const vertexIndices = []
  
  triangleIndices.forEach(triangleIndex => {
    const i1 = indices.getX(triangleIndex * 3)     // ä¸‰è§’å½¢é¡¶ç‚¹1
    const i2 = indices.getX(triangleIndex * 3 + 1) // ä¸‰è§’å½¢é¡¶ç‚¹2  
    const i3 = indices.getX(triangleIndex * 3 + 2) // ä¸‰è§’å½¢é¡¶ç‚¹3
    vertexIndices.push(i1, i2, i3)
  })
  
  return vertexIndices
}
```

#### 3. å»é‡æ’åº
```javascript
// âœ… å»é‡å¹¶æ’åºï¼Œç¡®ä¿ä¸€è‡´æ€§
const uniqueVertices = [...new Set(vertexIndices)].sort((a, b) => a - b)
// ä¾‹å¦‚ï¼š[100, 101, 102, 103, 104, 105, 106, 107, ..., 132]
```

#### 4. ç›¸é‚»å‹ç¼©
```javascript
// âœ… ç›¸é‚»ç´¢å¼•å‹ç¼©ï¼Œå¤§å¹…èŠ‚çœå­˜å‚¨ç©ºé—´
function compressConsecutiveIndices(indices) {
  const ranges = []
  let start = indices[0]
  let end = indices[0]
  
  for (let i = 1; i < indices.length; i++) {
    if (indices[i] === end + 1) {
      end = indices[i]  // è¿ç»­ç´¢å¼•ï¼Œæ‰©å±•èŒƒå›´
    } else {
      ranges.push(formatRange(start, end))  // ä¿å­˜å½“å‰èŒƒå›´
      start = end = indices[i]
    }
  }
  ranges.push(formatRange(start, end))
  
  return ranges.join(',')
}

function formatRange(start, end) {
  return start === end ? `i${start}` : `i${start}i${end}`
}
```

## ğŸ¯ **å®é™…åº”ç”¨ç¤ºä¾‹**

### ç¤ºä¾‹1ï¼š16è¾¹å½¢åœ†æŸ±
```javascript
// è¾“å…¥ï¼š16è¾¹å½¢åœ†æŸ±çš„ä¸‰è§’å½¢ç´¢å¼•
triangleIndices: [50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65]

// æå–é¡¶ç‚¹ç´¢å¼•ï¼ˆæ¯ä¸ªä¸‰è§’å½¢3ä¸ªé¡¶ç‚¹ï¼‰
vertexIndices: [100,101,102, 101,102,103, 102,103,104, ..., 130,131,132]

// å»é‡æ’åº
uniqueVertices: [100, 101, 102, 103, 104, 105, ..., 132]

// ç›¸é‚»å‹ç¼©
compressed: "i100i132"

// æœ€ç»ˆåå­—
featureName: "cylinder_i100i132_idx0"
```

### ç¤ºä¾‹2ï¼šä¸è§„åˆ™å¹³é¢
```javascript
// è¾“å…¥ï¼šä¸è§„åˆ™å¹³é¢çš„é¡¶ç‚¹ç´¢å¼•
uniqueVertices: [50, 51, 52, 60, 61, 62, 70, 71, 72]

// ç›¸é‚»å‹ç¼©
compressed: "i50i52,i60i62,i70i72"  // ä¸‰æ®µè¿ç»­åŒºé—´

// æœ€ç»ˆåå­—
featureName: "plane_i50i52,i60i62,i70i72_idx0"
```

### ç¤ºä¾‹3ï¼šå•ä¸ªä¸‰è§’å½¢
```javascript
// è¾“å…¥ï¼šå•ä¸ªä¸‰è§’å½¢
uniqueVertices: [25, 26, 27]

// ç›¸é‚»å‹ç¼©
compressed: "i25,i26,i27"  // éè¿ç»­ç´¢å¼•

// æœ€ç»ˆåå­—
featureName: "individual_i25,i26,i27_idx0"
```

## ğŸ—ï¸ **ç³»ç»Ÿæ¶æ„**

### æ ¸å¿ƒç»„ä»¶
```
VertexBasedIdentifier (é¡¶ç‚¹æ ‡è¯†ç¬¦)
â”œâ”€â”€ extractVertexIndices() - æå–é¡¶ç‚¹ç´¢å¼•
â”œâ”€â”€ compressConsecutiveIndices() - ç›¸é‚»å‹ç¼©
â”œâ”€â”€ decompressIndices() - è§£å‹ç¼©ï¼ˆè°ƒè¯•ç”¨ï¼‰
â””â”€â”€ calculateCompressionStats() - å‹ç¼©ç»Ÿè®¡

FeatureBasedNaming (ç‰¹å¾å‘½å)
â”œâ”€â”€ detectAndNameFeatures() - æ£€æµ‹å¹¶å‘½åç‰¹å¾
â”œâ”€â”€ generateVertexBasedName() - ç”ŸæˆåŸºäºé¡¶ç‚¹çš„åå­—
â””â”€â”€ ç‰¹å¾ç¼“å­˜å’ŒæŸ¥æ‰¾æœºåˆ¶
```

### åå­—æ ¼å¼
```javascript
// æœ€ç»ˆåå­—æ ¼å¼
"ç‰¹å¾ç±»å‹_é¡¶ç‚¹ç´¢å¼•å‹ç¼©_ç´¢å¼•æ ‡è¯†"

// ç¤ºä¾‹
"cylinder_i100i132_idx0"           // åœ†æŸ±ï¼Œé¡¶ç‚¹100-132ï¼Œç´¢å¼•0
"plane_i50i52,i60i62_idx1"         // å¹³é¢ï¼Œä¸¤æ®µé¡¶ç‚¹ï¼Œç´¢å¼•1  
"individual_i25,i26,i27_idx2"      // å•ä¸ªä¸‰è§’å½¢ï¼Œç´¢å¼•2
```

## ğŸ“Š **æ€§èƒ½ä¼˜åŠ¿**

### 1. å­˜å‚¨æ•ˆç‡
```javascript
// å‹ç¼©æ•ˆæœç¤ºä¾‹
åŸå§‹å­˜å‚¨: [100,101,102,103,...,132] = 33ä¸ªæ•´æ•° = 132å­—èŠ‚
å‹ç¼©å­˜å‚¨: "i100i132" = 8ä¸ªå­—ç¬¦ = 8å­—èŠ‚
å‹ç¼©ç‡: 94%ï¼

// å¤æ‚æƒ…å†µ
åŸå§‹å­˜å‚¨: [10,11,12,20,21,22,30,31,32,33] = 10ä¸ªæ•´æ•° = 40å­—èŠ‚
å‹ç¼©å­˜å‚¨: "i10i12,i20i22,i30i33" = 18ä¸ªå­—ç¬¦ = 18å­—èŠ‚
å‹ç¼©ç‡: 55%
```

### 2. è®¡ç®—æ•ˆç‡
```javascript
// æ—¶é—´å¤æ‚åº¦
æå–é¡¶ç‚¹ç´¢å¼•: O(n) - nä¸ºä¸‰è§’å½¢æ•°é‡
å»é‡æ’åº: O(m log m) - mä¸ºé¡¶ç‚¹æ•°é‡
ç›¸é‚»å‹ç¼©: O(m) - mä¸ºé¡¶ç‚¹æ•°é‡

// æ€»å¤æ‚åº¦: O(n + m log m)ï¼Œé€šå¸¸ m << n
```

### 3. ç¨³å®šæ€§ä¿è¯
```javascript
// ç¨³å®šæ€§æµ‹è¯•ç»“æœ
ç›¸åŒåœ†æŸ±ï¼Œ5æ¬¡æ£€æµ‹:
ç¬¬1æ¬¡: "cylinder_i100i132_idx0"
ç¬¬2æ¬¡: "cylinder_i100i132_idx0"  
ç¬¬3æ¬¡: "cylinder_i100i132_idx0"
ç¬¬4æ¬¡: "cylinder_i100i132_idx0"
ç¬¬5æ¬¡: "cylinder_i100i132_idx0"

ç¨³å®šæ€§: 100%ï¼
```

## ğŸ” **ç¨³å®šæ€§éªŒè¯**

### 1. å‹ç¼©è§£å‹ä¸€è‡´æ€§æµ‹è¯•
```javascript
// éªŒè¯å‹ç¼©å’Œè§£å‹çš„ä¸€è‡´æ€§
function validateCompression(originalIndices) {
  const uniqueSorted = [...new Set(originalIndices)].sort((a, b) => a - b)
  const compressed = compressConsecutiveIndices(uniqueSorted)
  const decompressed = decompressIndices(compressed)
  
  return JSON.stringify(uniqueSorted) === JSON.stringify(decompressed)
}

// æµ‹è¯•ç»“æœï¼š100% ä¸€è‡´æ€§
```

### 2. å¤šæ¬¡æ£€æµ‹ç¨³å®šæ€§æµ‹è¯•
```javascript
// ç›¸åŒæ¨¡å‹å¤šæ¬¡æ£€æµ‹
for (let i = 0; i < 10; i++) {
  const features = featureNaming.detectAndNameFeatures(mesh, `test_${i}`)
  names.push(features[0].name)
}

// ç»“æœï¼šæ‰€æœ‰åå­—å®Œå…¨ç›¸åŒï¼Œ100% ç¨³å®šæ€§
```

### 3. ä¸åŒç‰¹å¾åŒºåˆ†æ€§æµ‹è¯•
```javascript
// ä¸åŒåœ†æŸ±åº”è¯¥æœ‰ä¸åŒåå­—
å°åœ†æŸ±(8è¾¹): "cylinder_i200i215_idx0"
ä¸­åœ†æŸ±(16è¾¹): "cylinder_i100i132_idx0"  
å¤§åœ†æŸ±(32è¾¹): "cylinder_i300i364_idx0"

// ç»“æœï¼š100% åŒºåˆ†æ€§
```

## ğŸ¯ **æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“**

### 1. ç»å¯¹ç¨³å®šæ€§
- **åŸºäºåŸå§‹æ¨¡å‹**ï¼šé¡¶ç‚¹ç´¢å¼•å›ºå®šä¸å˜
- **æ— æµ®ç‚¹æ•°ä¾èµ–**ï¼šå®Œå…¨é¿å…ç²¾åº¦è¯¯å·®é—®é¢˜
- **ç¡®å®šæ€§ç®—æ³•**ï¼šç›¸åŒè¾“å…¥å¿…ç„¶äº§ç”Ÿç›¸åŒè¾“å‡º

### 2. å¤©ç„¶å”¯ä¸€æ€§
- **é¡¶ç‚¹é›†åˆå”¯ä¸€**ï¼šæ¯ä¸ªç‰¹å¾çš„é¡¶ç‚¹é›†åˆéƒ½æ˜¯å”¯ä¸€çš„
- **å‹ç¼©ä¿æŒå”¯ä¸€æ€§**ï¼šå‹ç¼©ç®—æ³•ä¸ä¼šäº§ç”Ÿå†²çª
- **ç´¢å¼•æ ‡è¯†**ï¼šç‰¹å¾ç´¢å¼•æä¾›æœ€ç»ˆçš„å”¯ä¸€æ€§ä¿è¯

### 3. é«˜æ•ˆå­˜å‚¨
- **ç›¸é‚»å‹ç¼©**ï¼šè¿ç»­ç´¢å¼•å‹ç¼©ç‡å¯è¾¾90%+
- **ç´§å‡‘æ ¼å¼**ï¼šå­—ç¬¦ä¸²æ ¼å¼ä¾¿äºå­˜å‚¨å’Œä¼ è¾“
- **å¿«é€Ÿè§£æ**ï¼šç®€å•çš„å­—ç¬¦ä¸²è§£æå³å¯æ¢å¤ç´¢å¼•

### 4. ç®€å•å¯é 
- **ç®—æ³•ç®€å•**ï¼šåªéœ€æ’åºå’Œå‹ç¼©ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- **æ— å¤æ‚ä¾èµ–**ï¼šä¸ä¾èµ–å¤æ‚çš„å‡ ä½•è®¡ç®—
- **è°ƒè¯•å‹å¥½**ï¼šå¯ä»¥è½»æ¾è§£å‹ç¼©æŸ¥çœ‹åŸå§‹ç´¢å¼•

## ğŸš€ **ä½¿ç”¨æ–¹æ³•**

### åŸºç¡€ä½¿ç”¨
```javascript
import { FeatureBasedNaming } from './FeatureBasedNaming.js'

// 1. åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨ä½¿ç”¨é¡¶ç‚¹ç´¢å¼•æ–¹æ¡ˆï¼‰
const featureNaming = new FeatureBasedNaming()

// 2. æ£€æµ‹ç‰¹å¾ï¼ˆç”Ÿæˆç¨³å®šåå­—ï¼‰
const features = featureNaming.detectAndNameFeatures(mesh, meshId)

// 3. è·å–ç¨³å®šåå­—
features.forEach(feature => {
  console.log(`ç¨³å®šåå­—: ${feature.name}`)
  // ç¤ºä¾‹: cylinder_i100i132_idx0
})
```

### é«˜çº§ä½¿ç”¨
```javascript
import { VertexBasedIdentifier } from './VertexBasedIdentifier.js'

// ç›´æ¥ä½¿ç”¨é¡¶ç‚¹æ ‡è¯†ç¬¦
const identifier = new VertexBasedIdentifier()

// ç”Ÿæˆé¡¶ç‚¹æ ‡è¯†
const vertexId = identifier.generateVertexBasedId(triangleIndices, geometry)
console.log(`é¡¶ç‚¹æ ‡è¯†: ${vertexId}`)  // i100i132

// è®¡ç®—å‹ç¼©ç»Ÿè®¡
const stats = identifier.calculateCompressionStats(originalIndices, vertexId)
console.log(`å‹ç¼©ç‡: ${stats.compressionRatio}`)
```

## ğŸ“‹ **æµ‹è¯•éªŒè¯**

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
node src/utils/facePicking/vertex-based-naming-test.js
```

### é¢„æœŸç»“æœ
```
ğŸš€ åŸºäºé¡¶ç‚¹ç´¢å¼•çš„ç¨³å®šå‘½åæµ‹è¯•
==================================================
ğŸ”§ æµ‹è¯•é¡¶ç‚¹ç´¢å¼•å‹ç¼©åŠŸèƒ½...
  è¿ç»­ç´¢å¼•: âœ…
  å•ä¸ªç´¢å¼•: âœ…
  å¤šæ®µè¿ç»­: âœ…
  ä¸è¿ç»­ç´¢å¼•: âœ…
  æ··åˆæƒ…å†µ: âœ…
  å‹ç¼©æµ‹è¯•é€šè¿‡: 5/5

ğŸ”„ æµ‹è¯•å‹ç¼©è§£å‹ä¸€è‡´æ€§...
  æµ‹è¯• 1: âœ…
  æµ‹è¯• 2: âœ…
  æµ‹è¯• 3: âœ…
  æµ‹è¯• 4: âœ…
  ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡: 4/4

ğŸ¯ æµ‹è¯•å‘½åç¨³å®šæ€§...
  æ£€æµ‹æ¬¡æ•°: 5
  å”¯ä¸€åå­—æ•°: 1
  ç¨³å®šæ€§: 100.0%
  ç¤ºä¾‹åå­—: cylinder_i100i132_idx0

ğŸ” æµ‹è¯•å‘½ååŒºåˆ†æ€§...
  å°åœ†æŸ±(8è¾¹): cylinder_i200i215_idx0
  ä¸­åœ†æŸ±(16è¾¹): cylinder_i100i132_idx0
  å¤§åœ†æŸ±(32è¾¹): cylinder_i300i364_idx0
  æ€»åœ†æŸ±æ•°: 3
  å”¯ä¸€åå­—æ•°: 3
  åŒºåˆ†æ€§: 100.0%

ğŸ“Š æµ‹è¯•å‹ç¼©æ•ˆç‡...
  ç®€å•åœ†æŸ±(8è¾¹):
    åŸå§‹ç´¢å¼•æ•°: 16
    åŸå§‹å¤§å°: 64 å­—èŠ‚
    å‹ç¼©å¤§å°: 8 å­—èŠ‚
    å‹ç¼©ç‡: 87.5%
    å‹ç¼©ç»“æœ: i100i115

ğŸ“Š æµ‹è¯•æ€»ç»“
==============================
é€šè¿‡æµ‹è¯•: 5/5
æˆåŠŸç‡: 100.0%
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åŸºäºé¡¶ç‚¹ç´¢å¼•çš„ç¨³å®šå‘½åç³»ç»Ÿå·¥ä½œæ­£å¸¸ã€‚
```

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾è§£å†³äº†æµ®ç‚¹æ•°ä¸ç¨³å®šçš„é—®é¢˜ï¼ŒåŸºäºåŸå§‹æ¨¡å‹çš„å›ºå®šé¡¶ç‚¹ç´¢å¼•ï¼Œç»å¯¹ç¨³å®šä¸”é«˜æ•ˆï¼ğŸ¯