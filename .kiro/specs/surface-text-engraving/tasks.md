# 表面文字雕刻功能实现计划

## 概述

基于现有面拾取系统实现表面文字雕刻功能，支持凸起和内嵌两种模式。

## 任务

- [x] 1. 创建核心文字系统架构
  - 创建SurfaceTextManager主控制器
  - 设置基本的文字对象数据结构
  - 集成到现有场景管理系统
  - _需求: 1.1, 6.1, 7.1_

- [ ] 2. 实现文字几何体生成器
  - [ ] 2.1 创建TextGeometryGenerator类
    - 使用Three.js TextGeometry生成3D文字
    - 支持字体、大小、厚度等参数配置
    - _需求: 1.3, 9.1, 9.2_

  - [ ] 2.2 实现字体管理系统
    - 加载和缓存字体文件
    - 提供默认字体回退机制
    - _需求: 9.1, 8.4_

- [ ] 3. 创建文字输入覆盖层
  - [ ] 3.1 实现TextInputOverlay组件
    - 在点击位置显示输入框
    - 处理用户输入和确认/取消操作
    - _需求: 1.2, 1.4_

  - [ ] 3.2 集成面拾取系统
    - 监听面拾取事件
    - 计算输入框的屏幕位置
    - _需求: 1.2, 1.5_

- [x] 4. 实现文字工具集成
  - [x] 4.1 添加文字工具到工具栏
    - 创建文字工具按钮
    - 实现工具状态切换
    - _需求: 1.1, 7.1_

  - [x] 4.2 实现文字添加工作流
    - 启用面拾取模式
    - 处理表面点击事件
    - 生成和放置文字几何体
    - _需求: 1.1, 1.2, 1.3, 1.5, 1.6_

- [x] 5. 创建文字属性编辑系统
  - [x] 5.1 实现TextPropertyPanel组件
    - 集成到现有属性面板
    - 提供文字内容编辑
    - 提供颜色选择器
    - _需求: 2.1, 2.2, 2.3_

  - [x] 5.2 实现雕刻模式切换
    - 添加凸起/内嵌模式选择
    - 实现模式切换逻辑
    - _需求: 2.4, 2.5_

  - [x] 5.3 实现实时属性更新
    - 监听属性变化事件
    - 实时更新文字几何体外观
    - _需求: 2.2, 2.3, 2.5_

- [ ] 6. 实现文字变换控制器
  - [ ] 6.1 创建TextTransformControls类
    - 集成Three.js TransformControls
    - 显示拖拽箭头控制器
    - _需求: 3.1, 3.2_

  - [ ] 6.2 实现位置拖拽功能
    - 处理拖拽事件
    - 提供实时视觉反馈
    - 限制移动范围
    - _需求: 3.3, 3.4, 3.5_

- [ ] 7. 实现凸起文字渲染
  - [ ] 7.1 实现凸起模式逻辑
    - 将文字几何体放置在表面上方
    - 设置适当的厚度和高度
    - _需求: 4.1, 4.2_

  - [ ] 7.2 优化凸起文字材质
    - 支持独立材质设置
    - 正确处理光照和阴影
    - _需求: 4.4, 4.5_

- [ ] 8. 实现内嵌文字布尔操作
  - [ ] 8.1 集成布尔操作库
    - 安装和配置three-bvh-csg库
    - 创建BooleanOperator类
    - _需求: 5.1, 5.2_

  - [ ] 8.2 实现布尔减法操作
    - 执行文字几何体与表面的布尔减法
    - 处理操作结果和错误情况
    - _需求: 5.2, 5.3, 5.6_

  - [ ] 8.3 优化布尔操作性能
    - 异步执行布尔操作
    - 显示操作进度
    - _需求: 5.4, 8.2_

- [ ] 9. 实现文字对象管理
  - [ ] 9.1 创建文字对象管理系统
    - 维护文字对象列表
    - 支持选择、删除、复制操作
    - _需求: 6.1, 6.2_

  - [ ] 9.2 实现撤销重做支持
    - 集成到现有撤销重做系统
    - 记录文字相关操作
    - _需求: 2.6, 3.6_

- [ ] 10. 性能优化和错误处理
  - [ ] 10.1 实现性能监控
    - 监控文字生成和布尔操作性能
    - 实现性能阈值检查
    - _需求: 8.1, 8.2, 8.3_

  - [ ] 10.2 完善错误处理机制
    - 处理布尔操作失败
    - 处理字体加载失败
    - 提供用户友好的错误提示
    - _需求: 8.4, 5.6_

- [ ] 11. 数据持久化
  - [ ] 11.1 实现文字对象序列化
    - 将文字对象保存到项目文件
    - 支持加载和恢复文字对象
    - _需求: 10.1, 10.2, 10.3_

- [ ] 12. 最终集成和测试
  - [ ] 12.1 完整功能集成测试
    - 测试完整的文字添加工作流
    - 验证所有功能正常工作
    - _需求: 所有需求_

  - [ ] 12.2 用户界面优化
    - 优化用户体验
    - 确保界面一致性
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

## 注意事项

- 任务标记为可选的子任务可以根据时间安排跳过
- 每个任务完成后需要进行基本测试验证
- 布尔操作是复杂功能，需要充分测试
- 性能优化应该在基本功能完成后进行